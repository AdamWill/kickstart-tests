url @KSTEST_URL@
install
network --bootproto=dhcp

bootloader --timeout=1
zerombr
clearpart --all
autopart

keyboard us
lang en
timezone America/New_York
rootpw qweqwe
shutdown

# Just install @core
%packages
%end

# Run the proxy
%include scripts/proxy-common.ks

%post --nochroot
# Look for the following as evidence that a proxy was used:
# a .treeinfo request
grep -q '\.treeinfo$' /tmp/proxy.log
if [[ $? -ne 0 ]]; then
    echo '.treeinfo request was not proxied' >> $ANA_INSTALL_PATH/root/RESULT
fi

# primary.xml from the repodata
grep -q 'repodata/.*primary.xml' /tmp/proxy.log
if [[ $? -ne 0 ]]; then
    echo 'repodata requests were not provxied' >> $ANA_INSTALL_PATH/root/RESULT
fi

# the kernel package from the Fedora repo
grep -q 'kernel-.*\.rpm' /tmp/proxy.log
if [[ $? -ne 0 ]]; then
    echo 'base repo package requests were not proxied' >> $ANA_INSTALL_PATH/root/RESULT
fi

# If nothing was written to RESULT, it worked
if [[ ! -f $ANA_INSTALL_PATH/root/RESULT ]]; then
    echo 'SUCCESS' > $ANA_INSTALL_PATH/root/RESULT
fi

# Write the result to the installed /root
echo "$result" > $ANA_INSTALL_PATH/root/RESULT
%end
